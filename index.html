<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>簡約行程 / 工具單頁 App</title>

  <!-- Google Font: Noto Sans JP（友好的日語字重）-->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">

  <!-- Tailwind Play CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    /* Tailwind 客製色系（主色 #9DC0DF）與樣式擴充 */
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: {
              50:  '#f3f8fb',
              100: '#e6f1f7',
              200: '#cfe2ef',
              300: '#b7d3e7',
              400: '#9fc4df',
              500: '#9dc0df', /* 主色 */
              600: '#7aa7c8',
              700: '#588aa0',
              800: '#3e6577',
              900: '#233c4b'
            },
            // 補充日系常用柔和灰
            softgray: {
              50: '#fbfbfc',
              100: '#f6f7f8',
              200: '#eceef0',
              300: '#e2e5e8',
              400: '#cfd6db',
              500: '#bfc9cf'
            }
          },
          borderRadius: {
            'xl': '1rem',
            'xxl': '1.25rem'
          },
          boxShadow: {
            'soft': '0 8px 20px rgba(36,64,86,0.06)', /* 柔和偏藍陰影 */
            'soft-sm': '0 4px 12px rgba(36,64,86,0.04)'
          }
        }
      }
    }
  </script>

  <!-- Vue 3 (global build) -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>

  <style>
    /* 全局：日系字體與背景柔和處理 */
    html,body,#app { height:100%; }
    body {
      background: linear-gradient(180deg, #fbfdff 0%, #ffffff 100%);
      -webkit-font-smoothing:antialiased;
      font-family: "Noto Sans JP", system-ui, -apple-system, "Hiragino Kaku Gothic ProN", "Yu Gothic", "PingFang TC", "Noto Sans TC", "Microsoft JhengHei", Arial;
      color: #263849;
    }

    /* 卡片：更柔的圓角與陰影 */
    .card-shadow { box-shadow: 0 8px 20px rgba(36,64,86,0.06); border-radius: 14px; }
    .card-soft { box-shadow: 0 4px 12px rgba(36,64,86,0.04); border-radius: 12px; }

    /* 按鈕過渡與 focus */
    .btn-focus:focus { outline: none; box-shadow: 0 0 0 4px rgba(157,192,223,0.22); border-radius: 12px; }
    .btn-ghost { background: transparent; border: 1px solid rgba(157,192,223,0.12); }

    /* 標題與文字風格 */
    h1, h2 { letter-spacing: -0.01em; }
    .muted { color: #7b8790; }

    /* 手機 App feel */
    .scroll-area { -webkit-overflow-scrolling: touch; overflow-y: auto; }
    /* 微細分割線使用淺灰色 */
    .soft-divider { border-color: rgba(36,64,86,0.06); }

    /* 小元件微調 */
    .input-row > * { min-width: 0; } /* allow flex inputs to shrink nicely */
  </style>
</head>
<body>
  <div id="app" class="min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-md bg-white rounded-xl card-shadow overflow-hidden">
      <!-- header -->
      <header class="px-4 py-5 border-b border-gray-100 flex items-center justify-between">
        <div>
          <h1 class="text-lg font-semibold text-slate-800">旅行小幫手</h1>
          <p class="text-sm text-slate-400">行程、地圖、記帳、清單與備忘</p>
        </div>
        <button @click="resetAll" class="text-sm text-primary-600 bg-primary-50 px-3 py-1 rounded-lg">重設</button>
      </header>

      <!-- 主選單 -->
      <nav class="px-3 py-3 flex gap-2 overflow-x-auto">
        <button :class="tab==='itinerary'?activeBtn:inactiveBtn" @click="tab='itinerary'">行程表</button>
        <button :class="tab==='map'?activeBtn:inactiveBtn" @click="tab='map'">地圖</button>
        <button :class="tab==='expenses'?activeBtn:inactiveBtn" @click="tab='expenses'">記帳</button>
        <button :class="tab==='shopping'?activeBtn:inactiveBtn" @click="tab='shopping'">購物清單</button>
        <button :class="tab==='notes'?activeBtn:inactiveBtn" @click="tab='notes'">備忘錄</button>
      </nav>

      <!-- 內容區 -->
      <main class="p-4 h-[70vh] scroll-area">
        <!-- 行程表 -->
        <section v-show="tab==='itinerary'">
          <div class="mb-3 flex items-center justify-between">
            <h2 class="text-md font-medium text-slate-800">行程表</h2>
            <div class="text-sm text-slate-400">自動儲存</div>
          </div>

          <!-- Days 選擇（橫向） -->
          <div class="mb-3">
            <div class="flex items-center gap-2 overflow-x-auto pb-2">
              <button
                v-for="(d, i) in days"
                :key="d.id"
                @click="currentDay = i"
                class="px-4 py-2 whitespace-nowrap rounded-xl text-sm transition border"
                :class="currentDay===i
                  ? 'bg-primary-500 text-white shadow-soft'
                  : 'bg-white text-slate-600 border-primary-100 shadow-soft-sm'"
              >
                Day {{ i+1 }}
                <div class="text-xs text-slate-400 mt-1">
                  {{ d.date ? formatDateShort(d.date) + ' ' + weekdayName(d.date) : '未設定日期' }}
                </div>
              </button>

              <button
                @click="addDay"
                class="px-3 py-2 rounded-xl bg-primary-50 text-primary-700 border border-primary-200 text-sm"
                title="新增一天"
              >＋ Day</button>

              <button
                @click="removeDay"
                class="px-3 py-2 rounded-xl bg-white border text-red-500 text-sm"
                :disabled="days.length===1"
              >刪除</button>
            </div>
          </div>

          <!-- 當前 Day 的行程列表 -->
          <div class="space-y-3 mb-4">
            <div v-if="days[currentDay].items.length===0" class="p-3 bg-primary-50 rounded-xl text-sm text-slate-500">
              目前 Day {{ currentDay + 1 }} 尚無行程，請在下方新增。
            </div>

            <div v-for="(item, idx) in days[currentDay].items" :key="item.id" class="p-3 bg-white border rounded-xl card-shadow flex items-start gap-3">
              <div class="flex-shrink-0">
                <div class="w-12 h-12 rounded-lg bg-primary-50 flex items-center justify-center text-primary-600 font-semibold">
                  {{ idx+1 }}
                </div>
              </div>
              <div class="flex-1">
                <div class="text-sm font-medium text-slate-800">{{ item.title }}</div>
                <div class="text-xs text-slate-400 mt-1">{{ item.time }}</div>
                <div class="text-xs text-slate-500 mt-2">{{ item.note }}</div>
              </div>
              <div class="flex flex-col gap-2">
                <button @click="editItin(currentDay, idx)" class="text-sm text-primary-600">編輯</button>
                <button @click="deleteItin(currentDay, idx)" class="text-sm text-red-500">刪除</button>
              </div>
            </div>
          </div>

          <!-- 新增行程卡（橫向 Row，灰色邊框） -->
          <div class="p-3 bg-white border rounded-xl card-soft">
            <div class="mb-3 text-sm text-slate-600">新增行程（請選擇日期與時間）</div>

            <div class="space-y-3">
              <!-- 日期 Row -->
              <div class="flex gap-3 input-row">
                <input
                  v-model="days[currentDay].date"
                  type="date"
                  class="flex-1 p-2 rounded-md border border-gray-200 focus:outline-none focus:ring-2 focus:ring-primary-200"
                />
                <input
                  v-model="newItin.title"
                  type="text"
                  placeholder="行程標題"
                  class="flex-1 p-2 rounded-md border border-gray-200 focus:outline-none focus:ring-2 focus:ring-primary-200"
                />
              </div>

              <!-- 時間與備註 Row -->
              <div class="flex gap-3 input-row">
                <input
                  v-model="newItin.time"
                  type="time"
                  class="w-1/3 p-2 rounded-md border border-gray-200 focus:outline-none focus:ring-2 focus:ring-primary-200"
                />
                <input
                  v-model="newItin.note"
                  type="text"
                  placeholder="備註"
                  class="flex-1 p-2 rounded-md border border-gray-200 focus:outline-none focus:ring-2 focus:ring-primary-200"
                />
              </div>
            </div>

            <!-- 底部按鈕：移到最底 -->
            <div class="mt-4 flex gap-3 justify-end">
              <button @click="clearNewItin" class="py-2 px-4 rounded-lg bg-white border text-slate-600">清除</button>
              <button @click="addItin" class="py-2 px-4 rounded-lg bg-primary-600 text-white">新增行程</button>
            </div>
          </div>
        </section>

        <!-- 地圖 -->
        <section v-show="tab==='map'">
          <h2 class="text-md font-medium text-slate-800 mb-2">地圖</h2>
          <p class="text-xs text-slate-400 mb-3">搜尋地點或使用嵌入地圖。</p>

          <div class="mb-3">
            <input v-model="mapQuery" @keyup.enter="searchMap" placeholder="輸入地點並按 Enter 搜尋（例如：Fukuoka）" class="w-full p-2 rounded-lg border focus:outline-none" />
            <div class="mt-2 flex gap-2">
              <button @click="searchMap" class="flex-1 py-2 rounded-lg bg-primary-600 text-white">搜尋</button>
              <button @click="centerDefault" class="py-2 px-3 rounded-lg bg-white border">回到預設</button>
            </div>
          </div>

          <!-- 使用 OpenStreetMap iframe -->
          <div class="w-full h-64 rounded-xl overflow-hidden border">
            <iframe :src="osmSrc" class="w-full h-full" ref="mapFrame" loading="lazy"></iframe>
          </div>
        </section>

        <!-- 記帳 -->
        <section v-show="tab==='expenses'">
          <div class="mb-3 flex items-center justify-between">
            <h2 class="text-md font-medium text-slate-800">記帳</h2>
            <div class="text-sm text-slate-400">共支出：<span class="font-semibold text-primary-600">{{ totalExpensesFormatted }}</span></div>
          </div>

          <div class="space-y-3">
            <div v-for="(e, i) in expenses" :key="e.id" class="p-3 bg-white border rounded-xl flex items-center justify-between">
              <div>
                <div class="text-sm font-medium">{{ e.title }}</div>
                <div class="text-xs text-slate-400">{{ e.date }}</div>
              </div>
              <div class="text-sm font-medium text-slate-800">HK$ {{ e.amount.toFixed(2) }}</div>
              <div class="ml-2">
                <button @click="removeExpense(i)" class="text-sm text-red-500">刪除</button>
              </div>
            </div>

            <div class="p-3 bg-primary-50 rounded-xl">
              <input v-model="newExpense.title" placeholder="項目" class="w-full mb-2 p-2 rounded-md" />
              <input v-model.number="newExpense.amount" type="number" placeholder="金額 (HK$)" class="w-full mb-2 p-2 rounded-md" />
              <input v-model="newExpense.date" type="date" class="w-full mb-2 p-2 rounded-md" />
              <div class="flex gap-2">
                <button @click="addExpense" class="flex-1 py-2 rounded-lg bg-primary-600 text-white">加入</button>
                <button @click="clearNewExpense" class="py-2 px-3 rounded-lg bg-white border">清除</button>
              </div>
            </div>
          </div>
        </section>

        <!-- 購物清單 -->
        <section v-show="tab==='shopping'">
          <h2 class="text-md font-medium text-slate-800 mb-2">購物清單</h2>
          <div class="space-y-2">
            <div v-for="(s, i) in shopping" :key="s.id" class="flex items-center gap-3 p-2 bg-white rounded-xl border">
              <input type="checkbox" v-model="s.done" class="w-5 h-5" />
              <div class="flex-1">
                <div :class="{'line-through text-slate-400': s.done}">{{ s.text }}</div>
                <div class="text-xs text-slate-400">{{ s.note }}</div>
              </div>
              <button @click="removeShopping(i)" class="text-sm text-red-500">刪除</button>
            </div>

            <div class="p-3 bg-primary-50 rounded-xl">
              <input v-model="newShop.text" placeholder="品項" class="w-full mb-2 p-2 rounded-md" />
              <input v-model="newShop.note" placeholder="備註" class="w-full mb-2 p-2 rounded-md" />
              <div class="flex gap-2">
                <button @click="addShop" class="flex-1 py-2 rounded-lg bg-primary-600 text-white">加入清單</button>
                <button @click="clearNewShop" class="py-2 px-3 rounded-lg bg-white border">清除</button>
              </div>
            </div>
          </div>
        </section>

        <!-- 備忘錄 -->
        <section v-show="tab==='notes'">
          <h2 class="text-md font-medium text-slate-800 mb-2">備忘錄</h2>

          <div class="space-y-3">
            <div v-for="(n, i) in notes" :key="n.id" class="p-3 bg-white border rounded-xl">
              <div class="text-sm font-medium">{{ n.title }}</div>
              <div class="text-xs text-slate-400 mt-1">{{ n.date }}</div>
              <div class="text-sm text-slate-700 mt-2">{{ n.content }}</div>
              <div class="mt-2 text-right">
                <button @click="removeNote(i)" class="text-sm text-red-500">刪除</button>
              </div>
            </div>

            <div class="p-3 bg-primary-50 rounded-xl">
              <input v-model="newNote.title" placeholder="標題" class="w-full mb-2 p-2 rounded-md" />
              <textarea v-model="newNote.content" rows="3" placeholder="內容" class="w-full p-2 rounded-md"></textarea>
              <div class="mt-2 flex gap-2">
                <button @click="addNote" class="flex-1 py-2 rounded-lg bg-primary-600 text-white">新增備忘</button>
                <button @click="clearNewNote" class="py-2 px-3 rounded-lg bg-white border">清除</button>
              </div>
            </div>
          </div>
        </section>
      </main>

      <!-- footer -->
      <footer class="px-4 py-3 border-t border-gray-100 text-xs text-slate-400 flex justify-between items-center">
        <div>資料保存在此裝置 (localStorage)</div>
        <div class="flex items-center gap-2">
          <button @click="exportData" class="text-sm text-primary-600">匯出 JSON</button>
          <button @click="importPrompt" class="text-sm text-slate-500">匯入 JSON</button>
        </div>
      </footer>
    </div>

    <!-- 匯入彈窗（原生 prompt 簡單處理） -->
  </div>

  <script>
    const { createApp, ref, reactive, onMounted, computed } = Vue;

    createApp({
      setup() {
        const tab = ref('itinerary');

        // data keys
        const STORAGE_KEY = 'travel_app_v1_days';

        // initial state
        const state = reactive({
          // days: 每天包含 date, time (optional), items:[{id,title,time,note}]
          days: [],
          expenses: [],
          shopping: [],
          notes: []
        });

        // UI models for forms
        const newItin = reactive({ title:'', time:'', note:'' });
        const newExpense = reactive({ title:'', amount:0, date:'' });
        const newShop = reactive({ text:'', note:'', done:false });
        const newNote = reactive({ title:'', content:'', date:'' });

        // Days control
        const currentDay = ref(0);

        // map search
        const mapQuery = ref('');
        const osmBase = 'https://www.openstreetmap.org/export/embed.html?';

        // helpers
        function cryptoId() {
          return Math.random().toString(36).slice(2, 10);
        }

        // load from localStorage
        function load() {
          try {
            const raw = localStorage.getItem(STORAGE_KEY);
            if (raw) {
              const obj = JSON.parse(raw);
              state.days = obj.days && obj.days.length ? obj.days : [{ id: cryptoId(), date:'', items:[] }];
              state.expenses = obj.expenses || [];
              state.shopping = obj.shopping || [];
              state.notes = obj.notes || [];
            } else {
              // default: one day with a sample item
              state.days = [
                {
                  id: cryptoId(),
                  date: '2026-01-10',
                  items: [
                    { id: cryptoId(), title:'抵達福岡機場', time: '09:30', note:'取行李、購票' }
                  ]
                }
              ];
              state.expenses = [];
              state.shopping = [];
              state.notes = [];
            }
            // ensure currentDay in bounds
            if (currentDay.value >= state.days.length) currentDay.value = state.days.length - 1;
          } catch (e) {
            console.error('load error', e);
            state.days = [{ id: cryptoId(), date:'', items:[] }];
          }
        }

        function save() {
          const obj = { days: state.days, expenses: state.expenses, shopping: state.shopping, notes: state.notes };
          localStorage.setItem(STORAGE_KEY, JSON.stringify(obj));
        }

        // Day operations
        function addDay() {
          state.days.push({ id: cryptoId(), date:'', items:[] });
          currentDay.value = state.days.length - 1;
          save();
        }
        function removeDay() {
          if (state.days.length <= 1) return;
          if (!confirm('確定刪除此天？該天所有行程將被移除')) return;
          state.days.splice(currentDay.value, 1);
          currentDay.value = Math.max(0, currentDay.value - 1);
          save();
        }

        // itinerary actions (per day)
        function addItin() {
          const day = state.days[currentDay.value];
          if (!newItin.title) return alert('請輸入行程標題');
          // ensure day exists
          if (!day) {
            alert('找不到目前的 Day，請先新增 Day');
            return;
          }
          day.items.push({ id: cryptoId(), title: newItin.title, time: newItin.time || '', note: newItin.note || '' });
          // clear inputs
          newItin.title = ''; newItin.time = ''; newItin.note = '';
          save();
        }
        function clearNewItin(){ newItin.title=''; newItin.time=''; newItin.note=''; }
        function deleteItin(dayIdx, idx){ if (confirm('確定刪除此行程？')) { state.days[dayIdx].items.splice(idx,1); save(); } }
        function editItin(dayIdx, idx){
          const it = state.days[dayIdx].items[idx];
          const newTitle = prompt('編輯標題', it.title);
          if (newTitle !== null) { it.title = newTitle; save(); }
        }

        // expenses
        function addExpense(){
          if (!newExpense.title || !newExpense.amount) return alert('請填寫項目與金額');
          state.expenses.push({ id:cryptoId(), title:newExpense.title, amount: Number(newExpense.amount), date: newExpense.date || (new Date()).toISOString().slice(0,10) });
          clearNewExpense(); save();
        }
        function clearNewExpense(){ newExpense.title=''; newExpense.amount=0; newExpense.date=''; }
        function removeExpense(i){ if(confirm('刪除此支出？')) { state.expenses.splice(i,1); save(); } }
        const totalExpenses = () => state.expenses.reduce((s,e)=>s+Number(e.amount||0),0);
        const totalExpensesFormatted = computed(()=> totalExpenses().toFixed(2));

        // shopping
        function addShop(){ if (!newShop.text) return alert('請輸入品項'); state.shopping.push({ id:cryptoId(), text:newShop.text, note:newShop.note || '', done:false }); clearNewShop(); save(); }
        function clearNewShop(){ newShop.text=''; newShop.note=''; newShop.done=false; }
        function removeShopping(i){ if(confirm('刪除此項目？')){ state.shopping.splice(i,1); save(); } }

        // notes
        function addNote(){ if (!newNote.title && !newNote.content) return alert('請輸入標題或內容'); state.notes.push({ id:cryptoId(), title:newNote.title, content:newNote.content, date:(new Date()).toLocaleString() }); clearNewNote(); save(); }
        function clearNewNote(){ newNote.title=''; newNote.content=''; }
        function removeNote(i){ if (confirm('刪除此備忘？')) { state.notes.splice(i,1); save(); } }

        // map
        const osmSrc = ref(osmBase + 'bbox=139.6,35.6,140.0,35.8&layer=mapnik');
        function searchMap(){
          if (!mapQuery.value) return alert('請輸入搜尋字串');
          const q = encodeURIComponent(mapQuery.value);
          osmSrc.value = 'https://www.openstreetmap.org/search?query=' + q + '#map=13';
        }
        function centerDefault() { osmSrc.value = osmBase + 'bbox=139.6,35.6,140.0,35.8&layer=mapnik'; }

        // export / import
        function exportData(){
          const data = { days: state.days, expenses: state.expenses, shopping: state.shopping, notes: state.notes };
          const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = 'travel-data.json';
          document.body.appendChild(a);
          a.click();
          a.remove();
          URL.revokeObjectURL(url);
        }
        function importPrompt(){
          const txt = prompt('請貼上 JSON（整個匯出檔內容）以匯入：');
          if (!txt) return;
          try {
            const obj = JSON.parse(txt);
            if (confirm('確定以此資料覆蓋本地資料嗎？')) {
              state.days = obj.days || [{ id: cryptoId(), date:'', items:[] }];
              state.expenses = obj.expenses || [];
              state.shopping = obj.shopping || [];
              state.notes = obj.notes || [];
              // reset currentDay if needed
              if (currentDay.value >= state.days.length) currentDay.value = Math.max(0, state.days.length - 1);
              save();
              alert('匯入完成');
            }
          } catch (e) {
            alert('解析錯誤：請確認為有效的 JSON');
          }
        }

        function resetAll(){
          if (!confirm('將清除所有本機資料，確定？')) return;
          state.days = [{ id: cryptoId(), date:'', items:[] }];
          state.expenses = []; state.shopping = []; state.notes = [];
          currentDay.value = 0;
          save();
        }

        // small util: formatted short date
        function formatDateShort(d) {
          if (!d) return '';
          try {
            const dt = new Date(d);
            const y = dt.getFullYear();
            const m = String(dt.getMonth()+1).padStart(2,'0');
            const day = String(dt.getDate()).padStart(2,'0');
            return `${y}/${m}/${day}`;
          } catch (e) { return d; }
        }
        function weekdayName(d) {
          if (!d) return '';
          try {
            const dt = new Date(d);
            const names = ['日','一','二','三','四','五','六'];
            return '（週' + names[dt.getDay()] + '）';
          } catch(e){ return ''; }
        }

        // on mount
        onMounted(()=> {
          load();
          window.addEventListener('beforeunload', save);
        });

        // expose to template
        return {
          tab,
          mapQuery, osmSrc,
          days: state.days,
          expenses: state.expenses,
          shopping: state.shopping,
          notes: state.notes,
          newItin, newExpense, newShop, newNote,
          currentDay,
          addDay, removeDay,
          addItin, clearNewItin, deleteItin, editItin,
          searchMap, centerDefault,
          addExpense, clearNewExpense, removeExpense, totalExpensesFormatted,
          addShop, clearNewShop, removeShopping,
          addNote, clearNewNote, removeNote,
          exportData, importPrompt, resetAll,
          formatDateShort, weekdayName,
          activeBtn: 'px-3 py-2 rounded-xl bg-primary-600 text-white text-sm',
          inactiveBtn: 'px-3 py-2 rounded-xl bg-white text-primary-600 border border-primary-100 text-sm'
        }
      }
    }).mount('#app')
  </script>
</body>
</html>
